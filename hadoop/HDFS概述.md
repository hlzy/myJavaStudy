## HDFS概述

## 1.1 HDFS背景

数据需要存放在更多的操作系统中，这样不方便管理和维护，所以迫切的需要一个系统来管理多台机器上的文件。HDFS是**分布式文件管理中的一种**。

## 1.2 HDFS定义

HDFS(hadoop distributed file system)

* 分布式的文件系统，通过多个服务器联合实现功能
* 通过目录树定位文件

使用场景：

* 一次写入，多次读出场景，不支持文件修改。
* 读写速度慢。

### 1.2.1 优点

a) 高容错性

- 多个副本。它通过增加副本形式，提高容错性
- 一个副本丢失，可以自动恢复

b) 适合处理大数据

* 数据规达到GB,TB，甚至PB
* 能够处理**百万**规模的文件数量
* 可以构建在**廉价机器**上

### 1.2.2 缺点

* 不适合低延时数据方案
* 无法高效对大量小文件存储
  * namenode：128G，小文件存储需要占用namenode空间（一个文件至少150B）。
  * 小文件存储寻址时间超过读取时间。
* 不支持并发写入，**文件随机修改**。

## 1.3 HDFS组成架构

![image-20201130234247629](HDFS%E6%A6%82%E8%BF%B0.assets/image-20201130234247629.png)

* NameNode:master
  * 管理HDFS的名称空间
  * 配置副本策略
  * 管理数据块（Block）映射信息
  * 处理客户端读写请求
* DataNode：slave
  * 存储时机数据的数据块
  * 执行数据块的读写操作
* client:
  * 文件切片。文件上传HDFS时候，client讲文件切成block
  * 与namenode交互，获取文件位置信息
  * 与datanode交互，读取或者写入数据
  * client提供命令管理HDFS，比如namenode format
  * client提供一些命令访问HDFS，如put,get
* Secondary namenode:不是Namenode的热备。当namenode挂掉时候，不能马上替换Namenode提供服务
  * 辅助namenode，分担工作量，定期合并fsimage和edits，并推送给Namenode
  * 在紧急情况下，可辅助恢复namenode

## 1.4 HDFS文件块大小

物理上分块存储（Block）,块大小配置参数dfs.blocksize，默认**128M**

通常块大小 = 寻址时间 * **传输速率** * 100

>HDFS也有块（Block）的概念，但它的块是一个很大的单元，默认是64MB。像硬盘中的文件系统一样，在HDFS中的文件将会按块大小进行分解，并作为独立的单元进行存储。但和硬盘中的文件系统不一样的是，存储在块中的一个比块小的文件并不会占据一个块大小的硬盘物理空间（HDFS中一个块只存储一个文件的内容）。
>　　那为什么HDFS中的块如此之大呢？
>　　HDFS的块之所以这么大，主要原因就是为了把寻道（Seek）时间最小化。如果一个块足够大，那么从硬盘传输数据的时间将远远大于寻找块的起始位置的时间。这样就使得HDFS的数据传输速度和硬盘的传输速度更加接近。
>让我们来个简单的计算，假设寻道时间大约为10ms，传输速度为100MB/s。为了使得寻道时间仅为传输时间的1%，我们就需要设置块的大小为100MB。尽管很多应用的HDFS使用128MB的块，但默认的大小是64MB，这个参数将随着新一代硬盘速度的增长而增长。
>　　虽然大块有一定好处，但也不能太大。MR中的Map tasks一般一次只处理一个块，所以如果你的tasks太少了（少于你集群中的节点数），相对于设置较小块的Jobs来说，你的Jobs将会运行得比较慢。

## 1.5 HDFS的Shell操作

> hdfs -help

均可以查询到

## 1.6 HDFS客户端操作

* Maven工程
* python工程