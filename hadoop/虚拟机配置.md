虚拟机：virtual box

ubuntu系统：ubuntu18



常见问题：

* 虚拟机安装过程卡死

设置打内存和增加处理器：如我将1024MB内存增加到2048MB，处理器由1个增加到2个

* 虚拟机能PING通主机但主机无法Ping通虚拟机



# 一 VirtualBox下的网络连接模式

VirtualBox常见的网络模式有如下5种：

- 网络地址转换（NAT）：Network Address Translation (NAT)

  默认模式，仅为虚拟机提供上网能力

- NAT网络：NAT Network

  虚拟机组成一个可以上网的局域网

- 桥接网络：Bridged networking

  满足更高级的网络需求，在虚拟机上模拟和运行服务器

- 内部网络：Internal networking

  虚拟机间组成一个和主机及外部网络完全隔离的网络

- 仅主机网络：Host-only networking

  主机和虚拟机间构成一个网络，不需要主机的物理网络。此时，虚拟网络接口类似于回环接口，在主机，虚拟机之间提供连接

## 1.1 将虚拟机网络设置为NAT模式

  无需选择虚拟网卡

  ![在这里插入图片描述](https://img-blog.csdnimg.cn/20191230085038969.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2x1Y2t5YmVnZ2Fy,size_16,color_FFFFFF,t_70)

  虚拟机内操作系统网络设置最好为启用DHCP，其默认ip为10.0.2.15，也可以设置静态IP(不推荐).

## 1.2 将虚拟机网络设置为NAT网络模式

1)需在【管理】菜单下选择【全局设定】，选取【网络】添加网络

![在这里插入图片描述](https://img-blog.csdnimg.cn/20191230085208281.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2x1Y2t5YmVnZ2Fy,size_16,color_FFFFFF,t_70)

默认的网络名为NetNetwork，默认的ip地址就是下面的网络cidr是10.0.2.0并支持DHCP，默认的网关是10.0.2.1（如果想使用配置静态ip会用到网关信息）

![在这里插入图片描述](https://img-blog.csdnimg.cn/20191230085225424.png)

你也可以修改网络cidr为自己需要的地址，比如：192.168.1.0，则默认网关为192.168.1.1，此后的虚拟机ip可能是192.168.1.2，192.168.1.3…

1. 虚拟机网络设置

在界面名称中选取刚刚建立的NAT网络名

![在这里插入图片描述](https://img-blog.csdnimg.cn/20191230085236471.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2x1Y2t5YmVnZ2Fy,size_16,color_FFFFFF,t_70)

虚拟机内操作系统如果使用静态ip，注意网关为10.0.2.1，dns可以设置为202.96.134.133

## 1.3 桥接模式（Bridged Networking）

对于桥接模式，VirtualBox在你的主机上使用一个设备驱动从你的物理网卡中过滤数据。该网络过滤驱动能够从物理网络中拦截数据，并且向其中注入数据，因此，以软件的方式建立一个新的网络接口。当虚拟机使用这样一个新的网络接口时，对于主机来说就像使用网线物理连接到这个网络接口一样。主机可以使用这个接口向虚拟机发送数据以及从虚拟机接收数据。这也意味着你可以在虚拟机和你的其他网络间进行路由或者桥接。

### 将虚拟机网络设置为桥接模式

![在这里插入图片描述](https://img-blog.csdnimg.cn/20191230085302855.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2x1Y2t5YmVnZ2Fy,size_16,color_FFFFFF,t_70)

## 1.4 内部网络（Internal Networking）

内部网络模式和主机及外部网络完全隔离，虚拟机在同一个网络名下组成内网，彼此通讯。建立内部网络模式时只需定义网络名，因不与主机通信，最大限度保证安全性。

### 将虚拟机设置为内部网络模式

![在这里插入图片描述](https://img-blog.csdnimg.cn/20191230085320407.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2x1Y2t5YmVnZ2Fy,size_16,color_FFFFFF,t_70)

在相同网络名下自动组件内网。

**注意：对于虚拟机内部操作系统来说，如果是linux系统需要手动配置ip地址，掩码，网关，否则没有ip地址**

## 1.5 仅主机网络（Host-Only Networking）

仅主机网络可以认为是桥接和内部网络模式的混合，由于是桥接网络，因此虚拟机彼此之间，以及虚拟机和主机之间可以彼此通讯，就像它们通过物理网络连接一样。由于又是内部网络，不存在物理网络接口，虚拟机不能和主机之外的世界通讯。

当使用仅主机网络模式时，VirtualBox会在你的主机上建立一个新的软件接口（虚拟网卡）。因此，你会发现在你的现有网卡旁边会多一个虚拟网卡。换句话说，对于桥接网络，虚拟机会附在现有的物理网卡上。对于仅主机网络，则在主机上建立一个回环接口（虚拟网卡）。对于内部网络，虚拟机间的流量外面是看不到的，而主机回环接口上的流量可以被拦截。

### 设置仅主机网络模式

1）添加或配置虚拟网卡

由于使用仅主机网络模式，需要一块虚拟网卡，因此你需要先添加虚拟网卡，通常在安装VirtualBox软件时，已经添加了一块虚拟网卡。

如需添加虚拟网卡，则按如下操作：

在【管理】菜单下，选择【主机网络过滤器】（此菜单用于管理主机网络配置中的虚拟网卡）

![在这里插入图片描述](https://img-blog.csdnimg.cn/20191230085350992.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2x1Y2t5YmVnZ2Fy,size_16,color_FFFFFF,t_70)

对于此虚拟网卡，需要注意一下内容：

- 默认为手动配置网卡ip，此ip是作为主机和虚拟机通信的ip地址（虚拟机ping主机时，需ping此ip），也是虚拟机内部网络的网关及dns（虚拟机手动设置ip时需要）
- 默认没有启用DHCP，此时虚拟机中的系统需手动设置IP，IP设置规则是：和虚拟网卡位于同一网段，掩码也相同，网关使用虚拟网卡ip，dns也使用此ip
- 如果没有启用DHCP，对于自动获取IP的虚拟机来说将没有ip地址，因此你如果想让虚拟机自动获取ip，此处应勾选启用DHCP，此时会使用192.168.15.2作为DHCP服务器。
- 建议在仅主机模式下虚拟机内操作系统使用静态ip配置网络，其网络配置要注意与虚拟网卡ip位于同一网段，否则主机访问连接虚拟机

以上的网卡又可见于windows控制面板下面：

![在这里插入图片描述](https://img-blog.csdnimg.cn/20191230085420947.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2x1Y2t5YmVnZ2Fy,size_16,color_FFFFFF,t_70)

2）在虚拟机中选择仅主机模式，并选择其桥接的虚拟网卡

**注意：如果虚拟机内部为启用DHCP，则虚拟网卡也需启用DHCP，否则虚拟机启动后无法分配IP**

![在这里插入图片描述](https://img-blog.csdnimg.cn/20191230085435796.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2x1Y2t5YmVnZ2Fy,size_16,color_FFFFFF,t_70)

## 1.6 仅主机网络+NAT设置

在仅主机网络中，虚拟机无法使用外部网络，如果需要在虚拟机上安装的软件来着互联网，需要使其能够访问互联网，而在NAT模式中，通过最小的设置就可以非常方便的访问互联网，因此我们可以结合这样的需求，搭建仅主机网络+NAT模式，此方式借助在虚拟机上通过配置两块网卡来实现。

1）首先，根据仅主机网络模式设置虚拟机的第一块网卡，在虚拟机内部最好使用静态ip设置（**当然使用dhcp的话，为保证主机可访问虚拟机则要保证其动态分配的ip位于虚拟网卡同一网段**）

![在这里插入图片描述](https://img-blog.csdnimg.cn/2019123008550192.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2x1Y2t5YmVnZ2Fy,size_16,color_FFFFFF,t_70)

**重要：第一块网卡一定要设置为Host-Only模式，第二块设置为NAT模式，否则会导致NAT模式下无法上网，因为linux下双网卡时，第二块网卡的默认网关会覆盖第一块网卡的默认网卡，会导致Host-Only的配置覆盖了NAT的部分设置，致使NAT可能无法访问外网**

2）设置虚拟机的第二块网卡为NAT模式

第二块网卡设置，注意勾选启用网络连接，在连接方式中选择【网络地址转换(NAT)】此模式无需设置界面名称。

NAT模式ip为虚拟机内部提供的DHCP服务器自动分配。

![在这里插入图片描述](https://img-blog.csdnimg.cn/20191230085508339.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2x1Y2t5YmVnZ2Fy,size_16,color_FFFFFF,t_70)

3） 启动虚拟机编辑网卡配置

a. 通过命令查看第一块网卡的配置情况：

```
cat /etc/sysconfig/network-scripts/ifcfg-eth0
1
```

如不一致使用vi进行编辑

![在这里插入图片描述](https://img-blog.csdnimg.cn/20191230085531354.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2x1Y2t5YmVnZ2Fy,size_16,color_FFFFFF,t_70)

配置说明：

- 第一块网卡的配置文件名为ifcfg-eth0
- device=eth0:使用设备为eth0
- onboot=yes：表示启动时连接
- bootproto=static，表示使用静态ip，如果启用dhcp则设置为dhcp
- name=“System eth0”：设备描述名
- hwaddr=xx:xx:xx:xx:xx:xx为第一块网卡mac地址，需与虚拟机网络配置中网卡1的mac一致
- ipaddr=xxx.xxx.xxx.xxx设置的静态ip
- gateway=192.168.15.1 虚拟机虚拟网卡ip
- dns1=202.96.134.133 DNS设置，可以不用设置，因本网卡不是用来访问外网的，可以不用理会

b. 默认情况下第二块网卡的配置还不存在，通过如下命令复制第一块网卡的配置，复制成ifcfg-eth1:

```
cp /etc/sysconfig/network-scripts/ifcfg-eth0 /etc/sysconfig/network-scripts/ifcfg-eth1
1
```

c. 使用vi编辑第二块网卡的配置

```
vi /etc/sysconfig/network-scripts/ifcfg-eth1
1
```

![在这里插入图片描述](https://img-blog.csdnimg.cn/20191230085547754.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2x1Y2t5YmVnZ2Fy,size_16,color_FFFFFF,t_70)
配置说明：

- device改为eth1,第二块网卡设备名
- uuid不用理会
- bootproto改为dhcp，动态获取ip
- nane中将eth0改为eth1
- hwaddr为第二块网卡mac地址，此处非常重要，改成virtualBox 虚拟机网络配置界面第二块网卡的mac地址，参见后图。
- ipaddr，gateway，dns1均使用#号进行注释，因为对于nat模式，虚拟机自动提供dhcp服务器，会自动设置。

下图为第二块网卡mac地址的查看位置：

![在这里插入图片描述](https://img-blog.csdnimg.cn/20191230085600771.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2x1Y2t5YmVnZ2Fy,size_16,color_FFFFFF,t_70)

d. 重启网络使配置生效

```
service network restart
1
```

![在这里插入图片描述](https://img-blog.csdnimg.cn/20191230085608960.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2x1Y2t5YmVnZ2Fy,size_16,color_FFFFFF,t_70)

此处仅主机模式下的ip为192.168.15.100，eth1为自动分配

通过如下命令查看网卡ip：

```
ifconfig -a
1
```

也可以使用如下命令查看指定网卡ip信息：

```
ifconfig eth1（或者eth0）
1
```

此时可以看到第二块网卡eth1自动分配的ip为10.0.3.15

![在这里插入图片描述](https://img-blog.csdnimg.cn/20191230085630442.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2x1Y2t5YmVnZ2Fy,size_16,color_FFFFFF,t_70)
e. ping外网

![在这里插入图片描述](https://img-blog.csdnimg.cn/20191230085648263.png)

f.ping主机

此时主机ip就是虚拟网卡ip，同时也是网关（192.168.15.1）

![在这里插入图片描述](https://img-blog.csdnimg.cn/20191230085701970.png)
g. 主机ping虚拟机：

![在这里插入图片描述](https://img-blog.csdnimg.cn/2019123008571872.png)

# 二 修改ubuntu静态IP

TODO



# 三 hadoop配置

本地服务器环境：

```wiki
ubuntu1:10.0.2.15/24
ubuntu2:10.0.2.4/24
```

